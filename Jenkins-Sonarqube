#!/usr/bin/env groovy

pipeline {

    agent {
        node {
            label 'dev-node'
        }
    }

    environment {
        AWS_ACCESS_KEY_ID = credentials('aws_access_key_id') 
        AWS_SECRET_ACCESS_KEY = credentials('aws_secret_access_key') 
        AWS_REGION = credentials('aws_region') 
        AWS_OUTPUT = credentials('aws_output') 
        AWS_ACCOUNT_ID = credentials('aws_account_id') 
    }

    stages {

        stage('Clone Repository') {
            steps {
                git branch: 'dev', credentialsId: '~/.ssh/jenkins_github_key', url: 'git@github.com:Cirrus-Biz/aline-account-microservice-SF.git'
            }
        }

        stage('Build Jar') {
            steps {
                sh 'mvn clean install -DskipTests'
            }
        }

        // stage('Sonar Scan') {
        //     steps {
        //         withSonarQubeEnv(installationName: 'sonarqube') { 
        //           sh './mvnw clean org.sonarsource.scanner.maven:sonar-maven-plugin:3.9.0.2155:sonar'
        //         }
        //     }
        // }
        // stage("Quality Gate") {
        //     steps {
        //         timeout(time: 2, unit: 'MINUTES') {
        //           waitForQualityGate abortPipeline: true
        //         }
        //     }
        // }

    }

}

